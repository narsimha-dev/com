"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _fs = _interopRequireDefault(require("fs"));

var _ini = _interopRequireDefault(require("ini"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }

function _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }

var Config =
/*#__PURE__*/
function () {
  function Config(emitter) {
    _classCallCheck(this, Config);

    this.emitter = emitter;
  }

  _createClass(Config, [{
    key: "read",
    value: function read() {
      this.credentials = _ini.default.parse(_fs.default.readFileSync(this.readFilename(), 'utf-8'));
      return this.credentials;
    }
  }, {
    key: "write",
    value: function write(data) {
      var local = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;

      _fs.default.writeFileSync(this.writeFilename(local), _ini.default.stringify(data));
    }
  }, {
    key: "readFilename",
    value: function readFilename() {
      var filename = localFile();

      if (_fs.default.existsSync(filename)) {
        return filename;
      }

      return homeFile();
    }
  }, {
    key: "writeFilename",
    value: function writeFilename() {
      var local = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : false;

      if (local) {
        return localFile();
      }

      return homeFile();
    }
  }, {
    key: "putAndSave",
    value: function putAndSave(values) {
      var writeLocal = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;
      var data = {};

      try {
        data = this.read();
      } catch (e) {
        this.emitter.warn('No existing config found. Writing to new file.');
      }

      for (var group in values) {
        data[group] = data[group] || {};
        var vals = values[group];

        for (var key in vals) {
          data[group][key] = vals[key];
        }
      }

      try {
        this.write(data, writeLocal);
        this.emitter.log("Credentials written to ".concat(this.writeFilename(writeLocal)));
      } catch (e) {
        this.emitter.error("Could not write credentials to ".concat(this.writeFilename(writeLocal), ". (").concat(e.message, ")"));
      }

      return data;
    }
  }]);

  return Config;
}();

var _default = Config; // private methods

exports.default = _default;

var localFile = function localFile() {
  return "".concat(process.cwd(), "/.nexmorc");
};

var homeFile = function homeFile() {
  var key = process.platform == 'win32' ? 'USERPROFILE' : 'HOME';
  return "".concat(process.env[key], "/.nexmorc");
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9jb25maWcuanMiXSwibmFtZXMiOlsiQ29uZmlnIiwiZW1pdHRlciIsImNyZWRlbnRpYWxzIiwiaW5pIiwicGFyc2UiLCJmcyIsInJlYWRGaWxlU3luYyIsInJlYWRGaWxlbmFtZSIsImRhdGEiLCJsb2NhbCIsIndyaXRlRmlsZVN5bmMiLCJ3cml0ZUZpbGVuYW1lIiwic3RyaW5naWZ5IiwiZmlsZW5hbWUiLCJsb2NhbEZpbGUiLCJleGlzdHNTeW5jIiwiaG9tZUZpbGUiLCJ2YWx1ZXMiLCJ3cml0ZUxvY2FsIiwicmVhZCIsImUiLCJ3YXJuIiwiZ3JvdXAiLCJ2YWxzIiwia2V5Iiwid3JpdGUiLCJsb2ciLCJlcnJvciIsIm1lc3NhZ2UiLCJwcm9jZXNzIiwiY3dkIiwicGxhdGZvcm0iLCJlbnYiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFBQTs7QUFDQTs7Ozs7Ozs7OztJQUVNQSxNOzs7QUFDSixrQkFBWUMsT0FBWixFQUFxQjtBQUFBOztBQUNuQixTQUFLQSxPQUFMLEdBQWVBLE9BQWY7QUFDRDs7OzsyQkFFTTtBQUNMLFdBQUtDLFdBQUwsR0FBbUJDLGFBQUlDLEtBQUosQ0FDakJDLFlBQUdDLFlBQUgsQ0FBZ0IsS0FBS0MsWUFBTCxFQUFoQixFQUFxQyxPQUFyQyxDQURpQixDQUFuQjtBQUdBLGFBQU8sS0FBS0wsV0FBWjtBQUNEOzs7MEJBRUtNLEksRUFBbUI7QUFBQSxVQUFiQyxLQUFhLHVFQUFQLEtBQU87O0FBQ3ZCSixrQkFBR0ssYUFBSCxDQUNFLEtBQUtDLGFBQUwsQ0FBbUJGLEtBQW5CLENBREYsRUFFRU4sYUFBSVMsU0FBSixDQUFjSixJQUFkLENBRkY7QUFJRDs7O21DQUVjO0FBQ2IsVUFBTUssUUFBUSxHQUFHQyxTQUFTLEVBQTFCOztBQUNBLFVBQUlULFlBQUdVLFVBQUgsQ0FBY0YsUUFBZCxDQUFKLEVBQTZCO0FBQzNCLGVBQU9BLFFBQVA7QUFDRDs7QUFDRCxhQUFPRyxRQUFRLEVBQWY7QUFDRDs7O29DQUUwQjtBQUFBLFVBQWJQLEtBQWEsdUVBQVAsS0FBTzs7QUFDekIsVUFBSUEsS0FBSixFQUFXO0FBQUUsZUFBT0ssU0FBUyxFQUFoQjtBQUFxQjs7QUFDbEMsYUFBT0UsUUFBUSxFQUFmO0FBQ0Q7OzsrQkFFVUMsTSxFQUEwQjtBQUFBLFVBQWxCQyxVQUFrQix1RUFBUCxLQUFPO0FBQ25DLFVBQUlWLElBQUksR0FBRyxFQUFYOztBQUVBLFVBQUk7QUFDRkEsUUFBQUEsSUFBSSxHQUFHLEtBQUtXLElBQUwsRUFBUDtBQUNELE9BRkQsQ0FFRSxPQUFPQyxDQUFQLEVBQVU7QUFDVixhQUFLbkIsT0FBTCxDQUFhb0IsSUFBYixDQUFrQixnREFBbEI7QUFDRDs7QUFFRCxXQUFLLElBQU1DLEtBQVgsSUFBb0JMLE1BQXBCLEVBQTRCO0FBQzFCVCxRQUFBQSxJQUFJLENBQUNjLEtBQUQsQ0FBSixHQUFjZCxJQUFJLENBQUNjLEtBQUQsQ0FBSixJQUFlLEVBQTdCO0FBQ0EsWUFBTUMsSUFBSSxHQUFHTixNQUFNLENBQUNLLEtBQUQsQ0FBbkI7O0FBQ0EsYUFBSyxJQUFNRSxHQUFYLElBQWtCRCxJQUFsQixFQUF3QjtBQUN0QmYsVUFBQUEsSUFBSSxDQUFDYyxLQUFELENBQUosQ0FBWUUsR0FBWixJQUFtQkQsSUFBSSxDQUFDQyxHQUFELENBQXZCO0FBQ0Q7QUFDRjs7QUFFRCxVQUFJO0FBQ0YsYUFBS0MsS0FBTCxDQUFXakIsSUFBWCxFQUFpQlUsVUFBakI7QUFDQSxhQUFLakIsT0FBTCxDQUFheUIsR0FBYixrQ0FBMkMsS0FBS2YsYUFBTCxDQUFtQk8sVUFBbkIsQ0FBM0M7QUFDRCxPQUhELENBR0UsT0FBT0UsQ0FBUCxFQUFVO0FBQ1YsYUFBS25CLE9BQUwsQ0FBYTBCLEtBQWIsMENBQXFELEtBQUtoQixhQUFMLENBQW1CTyxVQUFuQixDQUFyRCxnQkFBeUZFLENBQUMsQ0FBQ1EsT0FBM0Y7QUFDRDs7QUFDRCxhQUFPcEIsSUFBUDtBQUNEOzs7Ozs7ZUFHWVIsTSxFQUVmOzs7O0FBRUEsSUFBTWMsU0FBUyxHQUFHLFNBQVpBLFNBQVksR0FBVztBQUMzQixtQkFBVWUsT0FBTyxDQUFDQyxHQUFSLEVBQVY7QUFDRCxDQUZEOztBQUlBLElBQU1kLFFBQVEsR0FBRyxTQUFYQSxRQUFXLEdBQVc7QUFDMUIsTUFBTVEsR0FBRyxHQUFJSyxPQUFPLENBQUNFLFFBQVIsSUFBb0IsT0FBckIsR0FBZ0MsYUFBaEMsR0FBZ0QsTUFBNUQ7QUFDQSxtQkFBVUYsT0FBTyxDQUFDRyxHQUFSLENBQVlSLEdBQVosQ0FBVjtBQUNELENBSEQiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgZnMgICAgICBmcm9tICdmcyc7XG5pbXBvcnQgaW5pICAgICBmcm9tICdpbmknO1xuXG5jbGFzcyBDb25maWcge1xuICBjb25zdHJ1Y3RvcihlbWl0dGVyKSB7XG4gICAgdGhpcy5lbWl0dGVyID0gZW1pdHRlcjtcbiAgfVxuXG4gIHJlYWQoKSB7XG4gICAgdGhpcy5jcmVkZW50aWFscyA9IGluaS5wYXJzZShcbiAgICAgIGZzLnJlYWRGaWxlU3luYyh0aGlzLnJlYWRGaWxlbmFtZSgpLCAndXRmLTgnKVxuICAgICk7XG4gICAgcmV0dXJuIHRoaXMuY3JlZGVudGlhbHM7XG4gIH1cblxuICB3cml0ZShkYXRhLCBsb2NhbD1mYWxzZSkge1xuICAgIGZzLndyaXRlRmlsZVN5bmMoXG4gICAgICB0aGlzLndyaXRlRmlsZW5hbWUobG9jYWwpLFxuICAgICAgaW5pLnN0cmluZ2lmeShkYXRhKVxuICAgICk7XG4gIH1cblxuICByZWFkRmlsZW5hbWUoKSB7XG4gICAgY29uc3QgZmlsZW5hbWUgPSBsb2NhbEZpbGUoKTtcbiAgICBpZiAoZnMuZXhpc3RzU3luYyhmaWxlbmFtZSkpIHtcbiAgICAgIHJldHVybiBmaWxlbmFtZTtcbiAgICB9XG4gICAgcmV0dXJuIGhvbWVGaWxlKCk7XG4gIH1cblxuICB3cml0ZUZpbGVuYW1lKGxvY2FsPWZhbHNlKSB7XG4gICAgaWYgKGxvY2FsKSB7IHJldHVybiBsb2NhbEZpbGUoKTsgfVxuICAgIHJldHVybiBob21lRmlsZSgpO1xuICB9XG5cbiAgcHV0QW5kU2F2ZSh2YWx1ZXMsIHdyaXRlTG9jYWw9ZmFsc2UpIHtcbiAgICBsZXQgZGF0YSA9IHt9O1xuXG4gICAgdHJ5IHtcbiAgICAgIGRhdGEgPSB0aGlzLnJlYWQoKTtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICB0aGlzLmVtaXR0ZXIud2FybignTm8gZXhpc3RpbmcgY29uZmlnIGZvdW5kLiBXcml0aW5nIHRvIG5ldyBmaWxlLicpO1xuICAgIH1cblxuICAgIGZvciAoY29uc3QgZ3JvdXAgaW4gdmFsdWVzKSB7XG4gICAgICBkYXRhW2dyb3VwXSA9IGRhdGFbZ3JvdXBdIHx8IHt9O1xuICAgICAgY29uc3QgdmFscyA9IHZhbHVlc1tncm91cF07XG4gICAgICBmb3IgKGNvbnN0IGtleSBpbiB2YWxzKSB7XG4gICAgICAgIGRhdGFbZ3JvdXBdW2tleV0gPSB2YWxzW2tleV07XG4gICAgICB9XG4gICAgfVxuXG4gICAgdHJ5IHtcbiAgICAgIHRoaXMud3JpdGUoZGF0YSwgd3JpdGVMb2NhbCk7XG4gICAgICB0aGlzLmVtaXR0ZXIubG9nKGBDcmVkZW50aWFscyB3cml0dGVuIHRvICR7dGhpcy53cml0ZUZpbGVuYW1lKHdyaXRlTG9jYWwpfWApO1xuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIHRoaXMuZW1pdHRlci5lcnJvcihgQ291bGQgbm90IHdyaXRlIGNyZWRlbnRpYWxzIHRvICR7dGhpcy53cml0ZUZpbGVuYW1lKHdyaXRlTG9jYWwpfS4gKCR7ZS5tZXNzYWdlfSlgKTtcbiAgICB9XG4gICAgcmV0dXJuIGRhdGE7XG4gIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgQ29uZmlnO1xuXG4vLyBwcml2YXRlIG1ldGhvZHNcblxuY29uc3QgbG9jYWxGaWxlID0gZnVuY3Rpb24oKSB7XG4gIHJldHVybiBgJHtwcm9jZXNzLmN3ZCgpfS8ubmV4bW9yY2A7XG59O1xuXG5jb25zdCBob21lRmlsZSA9IGZ1bmN0aW9uKCkge1xuICBjb25zdCBrZXkgPSAocHJvY2Vzcy5wbGF0Zm9ybSA9PSAnd2luMzInKSA/ICdVU0VSUFJPRklMRScgOiAnSE9NRSc7XG4gIHJldHVybiBgJHtwcm9jZXNzLmVudltrZXldfS8ubmV4bW9yY2A7XG59O1xuIl19