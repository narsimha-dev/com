"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _colors = _interopRequireDefault(require("colors"));

var _fs = _interopRequireDefault(require("fs"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }

function _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }

var Response =
/*#__PURE__*/
function () {
  function Response(validator, emitter) {
    _classCallCheck(this, Response);

    this.emitter = emitter;
    this.validator = validator;
  }

  _createClass(Response, [{
    key: "accountSetup",
    value: function accountSetup(config, key, secret, flags) {
      var _this = this;

      return function (error, response) {
        _this.validator.response(error, response);

        config.putAndSave({
          'credentials': {
            'api_key': key,
            'api_secret': secret
          }
        }, flags.local);
      };
    }
  }, {
    key: "accountInfo",
    value: function accountInfo(client) {
      this.emitter.log("API Key:    ".concat(client.credentials.apiKey, "\nAPI Secret: ").concat(client.credentials.apiSecret));
    }
  }, {
    key: "accountBalance",
    value: function accountBalance(error, response) {
      this.validator.response(error, response);
      this.emitter.log("".concat(Number(response.value.toFixed(2)), " EUR"), "".concat(response.value, " EUR"));
    } // Pricing

  }, {
    key: "priceSms",
    value: function priceSms(error, response) {
      this.validator.response(error, response);
      this.emitter.log("".concat(response.price, " EUR"));
    }
  }, {
    key: "priceVoice",
    value: function priceVoice(error, response) {
      this.validator.response(error, response);
      this.emitter.log("".concat(response.price, " EUR"));
    }
  }, {
    key: "priceCountry",
    value: function priceCountry(error, response) {
      this.validator.response(error, response);

      if (response.networks && this.emitter.amplified) {
        this.emitter.table(response.networks, ['network', 'mtPrice'], ['network', 'mtPrice']);
      } else if (response.mt) {
        var price = this._maxPrice(response);

        this.emitter.log("".concat(price, " EUR"));
      } else {
        this.emitter.log('No price found');
      }
    }
  }, {
    key: "_maxPrice",
    value: function _maxPrice(response) {
      var prices = response.networks.map(function (network) {
        return parseFloat(network.mtPrice);
      });
      prices.push(parseFloat(response.mt));
      return Math.max.apply(null, prices);
    } // numbers

  }, {
    key: "numbersList",
    value: function numbersList(flags) {
      var _this2 = this;

      return function (error, response) {
        _this2.validator.response(error, response);

        if (response.numbers && response.numbers.length > 0) {
          _this2.emitter.pagination(flags, response);

          _this2.emitter.table(response.numbers, ['msisdn'], ['msisdn', 'country', 'type', 'features', 'voiceCallbackType', 'voiceCallbackValue', 'moHttpUrl', 'voiceStatusCallbackUrl']);
        } else {
          _this2.emitter.warn('No numbers');
        }
      };
    }
  }, {
    key: "numberSearch",
    value: function numberSearch(flags) {
      var _this3 = this;

      return function (error, response) {
        _this3.validator.response(error, response);

        if (response.numbers && response.numbers.length > 0) {
          _this3.emitter.pagination(flags, response);

          _this3.emitter.table(response.numbers, ['msisdn'], ['msisdn', 'country', 'cost', 'type', 'features']);
        } else {
          _this3.emitter.warn('No numbers');
        }
      };
    }
  }, {
    key: "numberBuyFromNumber",
    value: function numberBuyFromNumber(number) {
      var _this4 = this;

      return function (error, response) {
        _this4.validator.response(error, response);

        _this4.emitter.log("Number purchased: ".concat(number));
      };
    }
  }, {
    key: "numberBuyFromPattern",
    value: function numberBuyFromPattern(callback) {
      var _this5 = this;

      return function (error, response) {
        _this5.validator.response(error, response);

        if (response.numbers && response.numbers.length > 0) {
          callback(response.numbers[0].msisdn);
        } else {
          _this5.emitter.error('No numbers match your search');
        }
      };
    }
  }, {
    key: "numberCancel",
    value: function numberCancel(number) {
      var _this6 = this;

      return function (error, response) {
        _this6.validator.response(error, response);

        _this6.emitter.log("Number cancelled: ".concat(number));
      };
    }
  }, {
    key: "numberInsight",
    value: function numberInsight(callback) {
      var _this7 = this;

      return function (error, response) {
        _this7.validator.response(error, response);

        callback(response);
      };
    } // applications

  }, {
    key: "applicationsList",
    value: function applicationsList(flags) {
      var _this8 = this;

      return function (error, response) {
        _this8.validator.response(error, response);

        if (response._embedded && response._embedded.applications && response._embedded.applications.length > 0) {
          _this8.emitter.pagination(flags, response);

          _this8.emitter.table(response._embedded.applications, ['id', 'name'], ['id', 'name']);
        } else {
          _this8.emitter.warn('No applications');
        }
      };
    }
  }, {
    key: "applicationCreate",
    value: function applicationCreate(flags) {
      var _this9 = this;

      return function (error, response) {
        _this9.validator.response(error, response);

        _this9.emitter.list("Application created: ".concat(response.id), response);

        _this9._writeKey(flags.keyfile, response.keys.private_key);
      };
    }
  }, {
    key: "applicationShow",
    value: function applicationShow(error, response) {
      this.validator.response(error, response);
      this.emitter.list(null, response);
    }
  }, {
    key: "applicationUpdate",
    value: function applicationUpdate(error, response) {
      this.validator.response(error, response);
      this.emitter.list("Application updated: ".concat(response.id), response);
    }
  }, {
    key: "applicationDelete",
    value: function applicationDelete(error, response) {
      this.validator.response(error, response);
      this.emitter.log('Application deleted');
    }
  }, {
    key: "applicationNumbers",
    value: function applicationNumbers(app_id, flags) {
      var _this10 = this;

      return function (error, response) {
        _this10.validator.response(error, response);

        if (response.numbers && response.numbers.length > 0) {
          response.numbers = response.numbers.filter(function (number) {
            return number.voiceCallbackValue == app_id;
          });

          _this10.emitter.pagination(flags, response);

          _this10.emitter.table(response.numbers, ['msisdn'], ['msisdn', 'country', 'type', 'features', 'voiceCallbackType', 'voiceCallbackValue', 'moHttpUrl', 'voiceStatusCallbackUrl']);
        } else {
          _this10.emitter.warn('No numbers');
        }
      };
    } // links

  }, {
    key: "numberUpdate",
    value: function numberUpdate(error, response) {
      this.validator.response(error, response);
      this.emitter.log('Number updated');
    } // insight

  }, {
    key: "insightBasic",
    value: function insightBasic(error, response) {
      this.validator.response(error, response);
      this.emitter.list("".concat(response.international_format_number, " | ").concat(response.country_code), response);
    }
  }, {
    key: "insightStandard",
    value: function insightStandard(error, response) {
      this.validator.response(error, response);
      this.emitter.list("".concat(response.international_format_number, " | ").concat(response.country_code, " | ").concat(response.current_carrier.name), response);
    }
  }, {
    key: "_writeKey",
    value: function _writeKey(keyfile, private_key) {
      var _this11 = this;

      if (keyfile) {
        _fs.default.writeFile(keyfile, private_key, function (error) {
          if (error) {
            _this11.emitter.warn(error.message);

            _this11._promptKey(private_key);
          } else {
            _this11.emitter.log("Private Key saved to: ".concat(keyfile));
          }
        });
      } else {
        this._promptKey(private_key);
      }
    }
  }, {
    key: "_promptKey",
    value: function _promptKey(private_key) {
      this.emitter.log('\nPrivate Key:\n');
      this.emitter.log(_colors.default.red.bgWhite("".concat(private_key, "\n")));
      this.emitter.log('WARNING: You should save this key somewhere safe and secure now, it will not be provided again.');
    } // sending messages

  }, {
    key: "sendSms",
    value: function sendSms(error, response) {
      this.validator.response(error, response);
      var message = response.messages[0];
      this.emitter.log("Message sent to:   ".concat(message.to, "\nRemaining balance: ").concat(message['remaining-balance'], " EUR\nMessage price:     ").concat(message['message-price'], " EUR"));
    } // JWT

  }, {
    key: "generateJwt",
    value: function generateJwt(error, token) {
      this.validator.response(error, token);
      this.emitter.log("".concat(token), "JWT:   ".concat(token));
    }
  }]);

  return Response;
}();

var _default = Response;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9yZXNwb25zZS5qcyJdLCJuYW1lcyI6WyJSZXNwb25zZSIsInZhbGlkYXRvciIsImVtaXR0ZXIiLCJjb25maWciLCJrZXkiLCJzZWNyZXQiLCJmbGFncyIsImVycm9yIiwicmVzcG9uc2UiLCJwdXRBbmRTYXZlIiwibG9jYWwiLCJjbGllbnQiLCJsb2ciLCJjcmVkZW50aWFscyIsImFwaUtleSIsImFwaVNlY3JldCIsIk51bWJlciIsInZhbHVlIiwidG9GaXhlZCIsInByaWNlIiwibmV0d29ya3MiLCJhbXBsaWZpZWQiLCJ0YWJsZSIsIm10IiwiX21heFByaWNlIiwicHJpY2VzIiwibWFwIiwibmV0d29yayIsInBhcnNlRmxvYXQiLCJtdFByaWNlIiwicHVzaCIsIk1hdGgiLCJtYXgiLCJhcHBseSIsIm51bWJlcnMiLCJsZW5ndGgiLCJwYWdpbmF0aW9uIiwid2FybiIsIm51bWJlciIsImNhbGxiYWNrIiwibXNpc2RuIiwiX2VtYmVkZGVkIiwiYXBwbGljYXRpb25zIiwibGlzdCIsImlkIiwiX3dyaXRlS2V5Iiwia2V5ZmlsZSIsImtleXMiLCJwcml2YXRlX2tleSIsImFwcF9pZCIsImZpbHRlciIsInZvaWNlQ2FsbGJhY2tWYWx1ZSIsImludGVybmF0aW9uYWxfZm9ybWF0X251bWJlciIsImNvdW50cnlfY29kZSIsImN1cnJlbnRfY2FycmllciIsIm5hbWUiLCJmcyIsIndyaXRlRmlsZSIsIm1lc3NhZ2UiLCJfcHJvbXB0S2V5IiwiY29sb3JzIiwicmVkIiwiYmdXaGl0ZSIsIm1lc3NhZ2VzIiwidG8iLCJ0b2tlbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUFBOztBQUNBOzs7Ozs7Ozs7O0lBRU1BLFE7OztBQUNKLG9CQUFZQyxTQUFaLEVBQXVCQyxPQUF2QixFQUFnQztBQUFBOztBQUM5QixTQUFLQSxPQUFMLEdBQWVBLE9BQWY7QUFDQSxTQUFLRCxTQUFMLEdBQWlCQSxTQUFqQjtBQUNEOzs7O2lDQUVZRSxNLEVBQVFDLEcsRUFBS0MsTSxF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bG9ycyc7XG5pbXBvcnQgZnMgZnJvbSAnZnMnO1xuXG5jbGFzcyBSZXNwb25zZSB7XG4gIGNvbnN0cnVjdG9yKHZhbGlkYXRvciwgZW1pdHRlcikge1xuICAgIHRoaXMuZW1pdHRlciA9IGVtaXR0ZXI7XG4gICAgdGhpcy52YWxpZGF0b3IgPSB2YWxpZGF0b3I7XG4gIH1cblxuICBhY2NvdW50U2V0dXAoY29uZmlnLCBrZXksIHNlY3JldCwgZmxhZ3MpIHtcbiAgICByZXR1cm4gKGVycm9yLCByZXNwb25zZSkgPT4ge1xuICAgICAgdGhpcy52YWxpZGF0b3IucmVzcG9uc2UoZXJyb3IsIHJlc3BvbnNlKTtcbiAgICAgIGNvbmZpZy5wdXRBbmRTYXZlKHtcbiAgICAgICAgJ2NyZWRlbnRpYWxzJzoge1xuICAgICAgICAgICdhcGlfa2V5Jzoga2V5LFxuICAgICAgICAgICdhcGlfc2VjcmV0Jzogc2VjcmV0XG4gICAgICAgIH1cbiAgICAgIH0sIGZsYWdzLmxvY2FsKTtcbiAgICB9O1xuICB9XG5cbiAgYWNjb3VudEluZm8oY2xpZW50KSB7XG4gICAgdGhpcy5lbWl0dGVyLmxvZyhcbiAgICAgIGBBUEkgS2V5OiAgICAke2NsaWVudC5jcmVkZW50aWFscy5hcGlLZXl9XG5BUEkgU2VjcmV0OiAke2NsaWVudC5jcmVkZW50aWFscy5hcGlTZWNyZXR9YFxuICAgICk7XG4gIH1cblxuICBhY2NvdW50QmFsYW5jZShlcnJvciwgcmVzcG9uc2UpIHtcbiAgICB0aGlzLnZhbGlkYXRvci5yZXNwb25zZShlcnJvciwgcmVzcG9uc2UpO1xuICAgIHRoaXMuZW1pdHRlci5sb2coXG4gICAgICBgJHtOdW1iZXIoKHJlc3BvbnNlLnZhbHVlKS50b0ZpeGVkKDIpKX0gRVVSYCxcbiAgICAgIGAke3Jlc3BvbnNlLnZhbHVlfSBFVVJgXG4gICAgKTtcbiAgfVxuXG4gIC8vIFByaWNpbmdcblxuICBwcmljZVNtcyhlcnJvciwgcmVzcG9uc2UpIHtcbiAgICB0aGlzLnZhbGlkYXRvci5yZXNwb25zZShlcnJvciwgcmVzcG9uc2UpO1xuICAgIHRoaXMuZW1pdHRlci5sb2coYCR7cmVzcG9uc2UucHJpY2V9IEVVUmApO1xuICB9XG5cbiAgcHJpY2VWb2ljZShlcnJvciwgcmVzcG9uc2UpIHtcbiAgICB0aGlzLnZhbGlkYXRvci5yZXNwb25zZShlcnJvciwgcmVzcG9uc2UpO1xuICAgIHRoaXMuZW1pdHRlci5sb2coYCR7cmVzcG9uc2UucHJpY2V9IEVVUmApO1xuICB9XG5cbiAgcHJpY2VDb3VudHJ5KGVycm9yLCByZXNwb25zZSkge1xuICAgIHRoaXMudmFsaWRhdG9yLnJlc3BvbnNlKGVycm9yLCByZXNwb25zZSk7XG4gICAgaWYgKHJlc3BvbnNlLm5ldHdvcmtzICYmIHRoaXMuZW1pdHRlci5hbXBsaWZpZWQpIHtcbiAgICAgIHRoaXMuZW1pdHRlci50YWJsZShyZXNwb25zZS5uZXR3b3JrcywgWyduZXR3b3JrJywgJ210UHJpY2UnXSwgWyduZXR3b3JrJywgJ210UHJpY2UnXSk7XG4gICAgfSBlbHNlIGlmIChyZXNwb25zZS5tdCkge1xuICAgICAgY29uc3QgcHJpY2UgPSB0aGlzLl9tYXhQcmljZShyZXNwb25zZSk7XG4gICAgICB0aGlzLmVtaXR0ZXIubG9nKGAke3ByaWNlfSBFVVJgKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5lbWl0dGVyLmxvZygnTm8gcHJpY2UgZm91bmQnKTtcbiAgICB9XG4gIH1cblxuICBfbWF4UHJpY2UocmVzcG9uc2UpIHtcbiAgICBjb25zdCBwcmljZXMgPSByZXNwb25zZS5uZXR3b3Jrcy5tYXAoKG5ldHdvcmspID0+IHtcbiAgICAgIHJldHVybiBwYXJzZUZsb2F0KG5ldHdvcmsubXRQcmljZSk7XG4gICAgfSk7XG4gICAgcHJpY2VzLnB1c2gocGFyc2VGbG9hdChyZXNwb25zZS5tdCkpO1xuICAgIHJldHVybiBNYXRoLm1heC5hcHBseShudWxsLCBwcmljZXMpO1xuICB9XG5cbiAgLy8gbnVtYmVyc1xuXG4gIG51bWJlcnNMaXN0KGZsYWdzKSB7XG4gICAgcmV0dXJuIChlcnJvciwgcmVzcG9uc2UpID0+IHtcbiAgICAgIHRoaXMudmFsaWRhdG9yLnJlc3BvbnNlKGVycm9yLCByZXNwb25zZSk7XG4gICAgICBpZiAocmVzcG9uc2UubnVtYmVycyAmJiByZXNwb25zZS5udW1iZXJzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgdGhpcy5lbWl0dGVyLnBhZ2luYXRpb24oZmxhZ3MsIHJlc3BvbnNlKTtcbiAgICAgICAgdGhpcy5lbWl0dGVyLnRhYmxlKHJlc3BvbnNlLm51bWJlcnMsIFsnbXNpc2RuJ10sIFsnbXNpc2RuJywgJ2NvdW50cnknLCAndHlwZScsICdmZWF0dXJlcycsICd2b2ljZUNhbGxiYWNrVHlwZScsICd2b2ljZUNhbGxiYWNrVmFsdWUnLCAnbW9IdHRwVXJsJywgJ3ZvaWNlU3RhdHVzQ2FsbGJhY2tVcmwnXSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLmVtaXR0ZXIud2FybignTm8gbnVtYmVycycpO1xuICAgICAgfVxuICAgIH07XG4gIH1cblxuICBudW1iZXJTZWFyY2goZmxhZ3MpIHtcbiAgICByZXR1cm4gKGVycm9yLCByZXNwb25zZSkgPT4ge1xuICAgICAgdGhpcy52YWxpZGF0b3IucmVzcG9uc2UoZXJyb3IsIHJlc3BvbnNlKTtcbiAgICAgIGlmIChyZXNwb25zZS5udW1iZXJzICYmIHJlc3BvbnNlLm51bWJlcnMubGVuZ3RoID4gMCkge1xuICAgICAgICB0aGlzLmVtaXR0ZXIucGFnaW5hdGlvbihmbGFncywgcmVzcG9uc2UpO1xuICAgICAgICB0aGlzLmVtaXR0ZXIudGFibGUocmVzcG9uc2UubnVtYmVycywgWydtc2lzZG4nXSwgWydtc2lzZG4nLCAnY291bnRyeScsICdjb3N0JywgJ3R5cGUnLCAnZmVhdHVyZXMnXSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLmVtaXR0ZXIud2FybignTm8gbnVtYmVycycpO1xuICAgICAgfVxuICAgIH07XG4gIH1cblxuICBudW1iZXJCdXlGcm9tTnVtYmVyKG51bWJlcikge1xuICAgIHJldHVybiAoZXJyb3IsIHJlc3BvbnNlKSA9PiB7XG4gICAgICB0aGlzLnZhbGlkYXRvci5yZXNwb25zZShlcnJvciwgcmVzcG9uc2UpO1xuICAgICAgdGhpcy5lbWl0dGVyLmxvZyhgTnVtYmVyIHB1cmNoYXNlZDogJHtudW1iZXJ9YCk7XG4gICAgfTtcbiAgfVxuXG4gIG51bWJlckJ1eUZyb21QYXR0ZXJuKGNhbGxiYWNrKSB7XG4gICAgcmV0dXJuIChlcnJvciwgcmVzcG9uc2UpID0+IHtcbiAgICAgIHRoaXMudmFsaWRhdG9yLnJlc3BvbnNlKGVycm9yLCByZXNwb25zZSk7XG4gICAgICBpZiAocmVzcG9uc2UubnVtYmVycyAmJiByZXNwb25zZS5udW1iZXJzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgY2FsbGJhY2socmVzcG9uc2UubnVtYmVyc1swXS5tc2lzZG4pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5lbWl0dGVyLmVycm9yKCdObyBudW1iZXJzIG1hdGNoIHlvdXIgc2VhcmNoJyk7XG4gICAgICB9XG4gICAgfTtcbiAgfVxuXG4gIG51bWJlckNhbmNlbChudW1iZXIpIHtcbiAgICByZXR1cm4gKGVycm9yLCByZXNwb25zZSkgPT4ge1xuICAgICAgdGhpcy52YWxpZGF0b3IucmVzcG9uc2UoZXJyb3IsIHJlc3BvbnNlKTtcbiAgICAgIHRoaXMuZW1pdHRlci5sb2coYE51bWJlciBjYW5jZWxsZWQ6ICR7bnVtYmVyfWApO1xuICAgIH07XG4gIH1cblxuICBudW1iZXJJbnNpZ2h0KGNhbGxiYWNrKSB7XG4gICAgcmV0dXJuIChlcnJvciwgcmVzcG9uc2UpID0+IHtcbiAgICAgIHRoaXMudmFsaWRhdG9yLnJlc3BvbnNlKGVycm9yLCByZXNwb25zZSk7XG4gICAgICBjYWxsYmFjayhyZXNwb25zZSk7XG4gICAgfTtcbiAgfVxuXG4gIC8vIGFwcGxpY2F0aW9uc1xuXG4gIGFwcGxpY2F0aW9uc0xpc3QoZmxhZ3MpIHtcbiAgICByZXR1cm4gKGVycm9yLCByZXNwb25zZSkgPT4ge1xuICAgICAgdGhpcy52YWxpZGF0b3IucmVzcG9uc2UoZXJyb3IsIHJlc3BvbnNlKTtcbiAgICAgIGlmIChyZXNwb25zZS5fZW1iZWRkZWQgJiYgcmVzcG9uc2UuX2VtYmVkZGVkLmFwcGxpY2F0aW9ucyAmJiByZXNwb25zZS5fZW1iZWRkZWQuYXBwbGljYXRpb25zLmxlbmd0aCA+IDApIHtcbiAgICAgICAgdGhpcy5lbWl0dGVyLnBhZ2luYXRpb24oZmxhZ3MsIHJlc3BvbnNlKTtcbiAgICAgICAgdGhpcy5lbWl0dGVyLnRhYmxlKHJlc3BvbnNlLl9lbWJlZGRlZC5hcHBsaWNhdGlvbnMsIFsnaWQnLCAnbmFtZSddLCBbJ2lkJywgJ25hbWUnXSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLmVtaXR0ZXIud2FybignTm8gYXBwbGljYXRpb25zJyk7XG4gICAgICB9XG4gICAgfTtcbiAgfVxuXG4gIGFwcGxpY2F0aW9uQ3JlYXRlKGZsYWdzKSB7XG4gICAgcmV0dXJuIChlcnJvciwgcmVzcG9uc2UpID0+IHtcbiAgICAgIHRoaXMudmFsaWRhdG9yLnJlc3BvbnNlKGVycm9yLCByZXNwb25zZSk7XG4gICAgICB0aGlzLmVtaXR0ZXIubGlzdChgQXBwbGljYXRpb24gY3JlYXRlZDogJHtyZXNwb25zZS5pZH1gLCByZXNwb25zZSk7XG4gICAgICB0aGlzLl93cml0ZUtleShmbGFncy5rZXlmaWxlLCByZXNwb25zZS5rZXlzLnByaXZhdGVfa2V5KTtcbiAgICB9O1xuICB9XG5cbiAgYXBwbGljYXRpb25TaG93KGVycm9yLCByZXNwb25zZSkge1xuICAgIHRoaXMudmFsaWRhdG9yLnJlc3BvbnNlKGVycm9yLCByZXNwb25zZSk7XG4gICAgdGhpcy5lbWl0dGVyLmxpc3QobnVsbCwgcmVzcG9uc2UpO1xuICB9XG5cbiAgYXBwbGljYXRpb25VcGRhdGUoZXJyb3IsIHJlc3BvbnNlKSB7XG4gICAgdGhpcy52YWxpZGF0b3IucmVzcG9uc2UoZXJyb3IsIHJlc3BvbnNlKTtcbiAgICB0aGlzLmVtaXR0ZXIubGlzdChgQXBwbGljYXRpb24gdXBkYXRlZDogJHtyZXNwb25zZS5pZH1gLCByZXNwb25zZSk7XG4gIH1cblxuICBhcHBsaWNhdGlvbkRlbGV0ZShlcnJvciwgcmVzcG9uc2UpIHtcbiAgICB0aGlzLnZhbGlkYXRvci5yZXNwb25zZShlcnJvciwgcmVzcG9uc2UpO1xuICAgIHRoaXMuZW1pdHRlci5sb2coJ0FwcGxpY2F0aW9uIGRlbGV0ZWQnKTtcbiAgfVxuXG4gIGFwcGxpY2F0aW9uTnVtYmVycyhhcHBfaWQsIGZsYWdzKSB7XG4gICAgcmV0dXJuIChlcnJvciwgcmVzcG9uc2UpID0+IHtcbiAgICAgIHRoaXMudmFsaWRhdG9yLnJlc3BvbnNlKGVycm9yLCByZXNwb25zZSk7XG4gICAgICBpZiAocmVzcG9uc2UubnVtYmVycyAmJiByZXNwb25zZS5udW1iZXJzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgcmVzcG9uc2UubnVtYmVycyA9IHJlc3BvbnNlLm51bWJlcnMuZmlsdGVyKChudW1iZXIpID0+IHtcbiAgICAgICAgICByZXR1cm4gbnVtYmVyLnZvaWNlQ2FsbGJhY2tWYWx1ZSA9PSBhcHBfaWQ7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHRoaXMuZW1pdHRlci5wYWdpbmF0aW9uKGZsYWdzLCByZXNwb25zZSk7XG4gICAgICAgIHRoaXMuZW1pdHRlci50YWJsZShyZXNwb25zZS5udW1iZXJzLCBbJ21zaXNkbiddLCBbJ21zaXNkbicsICdjb3VudHJ5JywgJ3R5cGUnLCAnZmVhdHVyZXMnLCAndm9pY2VDYWxsYmFja1R5cGUnLCAndm9pY2VDYWxsYmFja1ZhbHVlJywgJ21vSHR0cFVybCcsICd2b2ljZVN0YXR1c0NhbGxiYWNrVXJsJ10pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5lbWl0dGVyLndhcm4oJ05vIG51bWJlcnMnKTtcbiAgICAgIH1cbiAgICB9O1xuICB9XG5cbiAgLy8gbGlua3NcblxuICBudW1iZXJVcGRhdGUoZXJyb3IsIHJlc3BvbnNlKSB7XG4gICAgdGhpcy52YWxpZGF0b3IucmVzcG9uc2UoZXJyb3IsIHJlc3BvbnNlKTtcbiAgICB0aGlzLmVtaXR0ZXIubG9nKCdOdW1iZXIgdXBkYXRlZCcpO1xuICB9XG5cbiAgLy8gaW5zaWdodFxuXG4gIGluc2lnaHRCYXNpYyhlcnJvciwgcmVzcG9uc2UpIHtcbiAgICB0aGlzLnZhbGlkYXRvci5yZXNwb25zZShlcnJvciwgcmVzcG9uc2UpO1xuICAgIHRoaXMuZW1pdHRlci5saXN0KGAke3Jlc3BvbnNlLmludGVybmF0aW9uYWxfZm9ybWF0X251bWJlcn0gfCAke3Jlc3BvbnNlLmNvdW50cnlfY29kZX1gLCByZXNwb25zZSk7XG4gIH1cblxuICBpbnNpZ2h0U3RhbmRhcmQoZXJyb3IsIHJlc3BvbnNlKSB7XG4gICAgdGhpcy52YWxpZGF0b3IucmVzcG9uc2UoZXJyb3IsIHJlc3BvbnNlKTtcbiAgICB0aGlzLmVtaXR0ZXIubGlzdChgJHtyZXNwb25zZS5pbnRlcm5hdGlvbmFsX2Zvcm1hdF9udW1iZXJ9IHwgJHtyZXNwb25zZS5jb3VudHJ5X2NvZGV9IHwgJHtyZXNwb25zZS5jdXJyZW50X2NhcnJpZXIubmFtZX1gLCByZXNwb25zZSk7XG4gIH1cblxuICBfd3JpdGVLZXkoa2V5ZmlsZSwgcHJpdmF0ZV9rZXkpIHtcbiAgICBpZiAoa2V5ZmlsZSkge1xuICAgICAgZnMud3JpdGVGaWxlKGtleWZpbGUsIHByaXZhdGVfa2V5LCAoZXJyb3IpID0+IHtcbiAgICAgICAgaWYoZXJyb3IpIHtcbiAgICAgICAgICB0aGlzLmVtaXR0ZXIud2FybihlcnJvci5tZXNzYWdlKTtcbiAgICAgICAgICB0aGlzLl9wcm9tcHRLZXkocHJpdmF0ZV9rZXkpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHRoaXMuZW1pdHRlci5sb2coYFByaXZhdGUgS2V5IHNhdmVkIHRvOiAke2tleWZpbGV9YCk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLl9wcm9tcHRLZXkocHJpdmF0ZV9rZXkpO1xuICAgIH1cbiAgfVxuXG4gIF9wcm9tcHRLZXkocHJpdmF0ZV9rZXkpIHtcbiAgICB0aGlzLmVtaXR0ZXIubG9nKCdcXG5Qcml2YXRlIEtleTpcXG4nKTtcbiAgICB0aGlzLmVtaXR0ZXIubG9nKGNvbG9ycy5yZWQuYmdXaGl0ZShgJHtwcml2YXRlX2tleX1cXG5gKSk7XG4gICAgdGhpcy5lbWl0dGVyLmxvZygnV0FSTklORzogWW91IHNob3VsZCBzYXZlIHRoaXMga2V5IHNvbWV3aGVyZSBzYWZlIGFuZCBzZWN1cmUgbm93LCBpdCB3aWxsIG5vdCBiZSBwcm92aWRlZCBhZ2Fpbi4nKTtcbiAgfVxuXG4gIC8vIHNlbmRpbmcgbWVzc2FnZXNcblxuICBzZW5kU21zKGVycm9yLCByZXNwb25zZSkge1xuICAgIHRoaXMudmFsaWRhdG9yLnJlc3BvbnNlKGVycm9yLCByZXNwb25zZSk7XG4gICAgY29uc3QgbWVzc2FnZSA9IHJlc3BvbnNlLm1lc3NhZ2VzWzBdO1xuICAgIHRoaXMuZW1pdHRlci5sb2coYE1lc3NhZ2Ugc2VudCB0bzogICAke21lc3NhZ2UudG99XG5SZW1haW5pbmcgYmFsYW5jZTogJHttZXNzYWdlWydyZW1haW5pbmctYmFsYW5jZSddfSBFVVJcbk1lc3NhZ2UgcHJpY2U6ICAgICAke21lc3NhZ2VbJ21lc3NhZ2UtcHJpY2UnXX0gRVVSYCk7XG4gIH1cblxuICAvLyBKV1RcblxuICBnZW5lcmF0ZUp3dChlcnJvciwgdG9rZW4pIHtcbiAgICB0aGlzLnZhbGlkYXRvci5yZXNwb25zZShlcnJvciwgdG9rZW4pO1xuICAgIHRoaXMuZW1pdHRlci5sb2coYCR7dG9rZW59YCwgYEpXVDogICAke3Rva2VufWApO1xuICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IFJlc3BvbnNlO1xuIl19